<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone K8s Test Data Generator</title>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; }
        .header h1 { margin: 0; font-size: 2.5rem; font-weight: 700; }
        .header p { margin: 10px 0 0 0; font-size: 1.2rem; opacity: 0.9; }
        
        .controls { text-align: center; margin-bottom: 30px; }
        .btn { padding: 15px 30px; margin: 10px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; transform: translateY(-2px); }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; transform: translateY(-2px); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; border-left: 4px solid #3b82f6; }
        .stat-value { font-size: 2.5rem; font-weight: 700; color: #1f2937; margin: 10px 0; }
        .stat-label { font-size: 0.9rem; color: #6b7280; text-transform: uppercase; font-weight: 600; }
        
        .content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .panel { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .panel h2 { margin: 0 0 20px 0; color: #1f2937; font-size: 1.5rem; }
        
        .situation-item, .alert-item { background: #f8fafc; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #3b82f6; }
        .situation-item.high { border-left-color: #ef4444; }
        .situation-item.medium { border-left-color: #f59e0b; }
        .situation-item.low { border-left-color: #10b981; }
        
        .situation-title, .alert-title { font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .situation-score { font-size: 0.9rem; color: #6b7280; }
        .situation-details, .alert-details { font-size: 0.9rem; color: #6b7280; line-height: 1.5; }
        
        .console-output { background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px; max-height: 400px; overflow-y: auto; margin-top: 20px; }
        pre { margin: 0; white-space: pre-wrap; }
        
        .loading { display: none; text-align: center; padding: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .status { padding: 15px; margin: 15px 0; border-radius: 6px; font-weight: 500; }
        .success { background: #d1f2eb; color: #0e6251; border: 1px solid #a3e4d7; }
        .error { background: #fadbd8; color: #78281f; border: 1px solid #f1948a; }
        .info { background: #d6eaf8; color: #1b4f72; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® Standalone K8s Test Data Generator</h1>
            <p>Generate and display K8s events, Datadog alerts, and LogicMonitor alerts</p>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" onclick="loadScript()">Load K8s Correlator</button>
            <button class="btn btn-success" onclick="generateTestData()" id="generateBtn" disabled>Generate Test Data</button>
            <button class="btn btn-warning" onclick="clearAll()">Clear All</button>
        </div>
        
        <div id="status" class="status info">Ready to load K8s Correlator...</div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing test data...</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalAlerts">0</div>
                <div class="stat-label">Total Alerts</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeSituations">0</div>
                <div class="stat-label">Active Situations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="k8sEvents">0</div>
                <div class="stat-label">K8s Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="datadogAlerts">0</div>
                <div class="stat-label">Datadog Alerts</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="logicMonitorAlerts">0</div>
                <div class="stat-label">LogicMonitor Alerts</div>
            </div>
        </div>
        
        <div class="content">
            <div class="panel">
                <h2>üéØ Generated Situations</h2>
                <div id="situationsList">
                    <p style="color: #6b7280; text-align: center;">No situations generated yet</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>üö® Generated Alerts</h2>
                <div id="alertsList">
                    <p style="color: #6b7280; text-align: center;">No alerts generated yet</p>
                </div>
            </div>
        </div>
        
        <div class="console-output">
            <h3>Console Output</h3>
            <pre id="console-content">Ready to generate test data...</pre>
            <button class="btn btn-warning" onclick="clearConsole()" style="margin-top: 10px;">Clear Console</button>
        </div>
    </div>

    <script>
        let correlator = null;
        
        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsole(type, ...args) {
            const consoleContent = document.getElementById('console-content');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    try {
                        return JSON.stringify(arg, null, 2);
                    } catch (e) {
                        return String(arg);
                    }
                }
                return String(arg);
            }).join(' ');
            
            consoleContent.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
        }
        
        console.log = (...args) => {
            originalLog.apply(console, args);
            addToConsole('log', ...args);
        };
        
        console.error = (...args) => {
            originalError.apply(console, args);
            addToConsole('error', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn.apply(console, args);
            addToConsole('warn', ...args);
        };
        
        function clearConsole() {
            document.getElementById('console-content').textContent = 'Console cleared...\n';
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function loadScript() {
            updateStatus('Loading K8s Correlator script...', 'info');
            console.log('üöÄ Loading K8s Correlator script...');
            
            const script = document.createElement('script');
            script.src = 'main-enhanced.js';
            
            script.onload = () => {
                console.log('‚úÖ Script loaded successfully!');
                
                // Check if classes are available
                if (window.EnhancedCorrelator) {
                    console.log('‚úÖ EnhancedCorrelator class found!');
                    
                    try {
                        // Create instance
                        correlator = new window.EnhancedCorrelator();
                        console.log('‚úÖ Correlator instance created:', correlator);
                        
                        // Override the update methods to work with our standalone page
                        overrideUpdateMethods();
                        
                        // Enable generate button
                        document.getElementById('generateBtn').disabled = false;
                        
                        updateStatus('‚úÖ K8s Correlator loaded successfully! Ready to generate test data.', 'success');
                        console.log('üéâ Ready to generate test data!');
                        
                    } catch (error) {
                        console.error('‚ùå Failed to create correlator instance:', error);
                        updateStatus(`‚ùå Failed to create correlator instance: ${error.message}`, 'error');
                    }
                } else {
                    console.error('‚ùå EnhancedCorrelator class not found!');
                    updateStatus('‚ùå EnhancedCorrelator class not found!', 'error');
                }
            };
            
            script.onerror = (error) => {
                console.error('‚ùå Script failed to load:', error);
                updateStatus('‚ùå Script failed to load!', 'error');
            };
            
            document.head.appendChild(script);
        }
        
        function overrideUpdateMethods() {
            if (!correlator) return;
            
            console.log('üîß Overriding update methods for standalone page...');
            
            // Override updateStats to work with our page
            correlator.updateStats = function() {
                console.log('üìä Updating stats for standalone page...');
                document.getElementById('totalAlerts').textContent = this.stats.totalAlerts || 0;
                document.getElementById('activeSituations').textContent = this.stats.totalSituations || 0;
                document.getElementById('k8sEvents').textContent = this.stats.k8sEvents || 0;
                document.getElementById('datadogAlerts').textContent = this.stats.datadogAlerts || 0;
                document.getElementById('logicMonitorAlerts').textContent = this.stats.logicMonitorAlerts || 0;
                console.log('‚úÖ Stats updated:', this.stats);
            };
            
            // Override updateSituations to work with our page
            correlator.updateSituations = function(situations) {
                console.log('üéØ Updating situations for standalone page:', situations);
                const container = document.getElementById('situationsList');
                
                if (!container) {
                    console.warn('No situations container found');
                    return;
                }
                
                if (!situations || situations.length === 0) {
                    container.innerHTML = '<p style="color: #6b7280; text-align: center;">No active situations</p>';
                    return;
                }
                
                container.innerHTML = situations.map(situation => {
                    const severity = situation.severity || 'medium';
                    const score = situation.score || 0;
                    const primaryCause = situation.primary_cause || {};
                    const entities = situation.entities || [];
                    const services = situation.services || [];
                    
                    return `
                        <div class="situation-item ${severity}">
                            <div class="situation-title">${primaryCause.entity || 'Unknown Entity'}</div>
                            <div class="situation-score">Score: ${(score * 100).toFixed(0)}%</div>
                            <div class="situation-details">
                                <strong>Severity:</strong> ${severity}<br>
                                <strong>Entities:</strong> ${entities.length || 0}<br>
                                <strong>Services:</strong> ${services.length || 0}<br>
                                <strong>Primary Cause:</strong> ${primaryCause.source || 'Unknown'}
                            </div>
                        </div>
                    `;
                }).join('');
                
                console.log('‚úÖ Situations updated');
            };
            
            // Override updateAlerts to work with our page
            correlator.updateAlerts = function(alerts) {
                console.log('üö® Updating alerts for standalone page:', alerts);
                const container = document.getElementById('alertsList');
                
                if (!container) {
                    console.warn('No alerts container found');
                    return;
                }
                
                if (!alerts || alerts.length === 0) {
                    container.innerHTML = '<p style="color: #6b7280; text-align: center;">No recent alerts</p>';
                    return;
                }
                
                container.innerHTML = alerts.map(alert => {
                    const title = alert.title || 'Unknown Alert';
                    const severity = alert.severity || 'medium';
                    const message = alert.message || title;
                    const service = alert.service || 'N/A';
                    const source = alert.source || 'Unknown';
                    const timestamp = alert.ts ? new Date(alert.ts).toLocaleTimeString() : 'Unknown Time';
                    
                    return `
                        <div class="alert-item">
                            <div class="alert-title">${title}</div>
                            <div class="alert-details">
                                ${message}<br>
                                <strong>Service:</strong> ${service}<br>
                                <strong>Source:</strong> ${source}<br>
                                <strong>Time:</strong> ${timestamp}
                            </div>
                        </div>
                    `;
                }).join('');
                
                console.log('‚úÖ Alerts updated');
            };
            
            console.log('‚úÖ Update methods overridden successfully');
        }
        
        function generateTestData() {
            if (!correlator) {
                updateStatus('‚ùå Correlator not loaded!', 'error');
                return;
            }
            
            updateStatus('Generating test data...', 'info');
            console.log('üöÄ Starting test data generation...');
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Call generateTestData
                correlator.generateTestData();
                
                console.log('‚úÖ Test data generation initiated!');
                updateStatus('‚úÖ Test data generated successfully!', 'success');
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå Error generating test data:', error);
                updateStatus(`‚ùå Error generating test data: ${error.message}`, 'error');
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function clearAll() {
            console.log('üßπ Clearing all data...');
            
            // Reset stats
            document.getElementById('totalAlerts').textContent = '0';
            document.getElementById('activeSituations').textContent = '0';
            document.getElementById('k8sEvents').textContent = '0';
            document.getElementById('datadogAlerts').textContent = '0';
            document.getElementById('logicMonitorAlerts').textContent = '0';
            
            // Clear lists
            document.getElementById('situationsList').innerHTML = '<p style="color: #6b7280; text-align: center;">No situations generated yet</p>';
            document.getElementById('alertsList').innerHTML = '<p style="color: #6b7280; text-align: center;">No alerts generated yet</p>';
            
            updateStatus('All data cleared', 'info');
            console.log('‚úÖ All data cleared!');
        }
        
        // Auto-load script when page loads
        window.addEventListener('load', () => {
            console.log('üåê Page loaded, ready to load K8s Correlator...');
        });
    </script>
</body>
</html>
